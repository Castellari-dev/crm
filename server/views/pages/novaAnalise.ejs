<!DOCTYPE html>
<html>

  <head>
    <meta charset="UTF-8">
    <title>Analise</title>
    <script src="https://kit.fontawesome.com/cae5d463b6.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">    
    <link rel="stylesheet" href="/assets/style/style.css">
    <script src="/assets/js/menu.js"></script>
    <script src="/assets/js/iconsHeader.js"></script>



  </head>
  <header>
    <nav class="headerBar">
      <div class="textHeader">Analise</div>

      <!--          ICONES DE MENU FLUTUANTE DO HEADER             -->
      <div class="iconsHeaderContainer">
        <div class="iconsHeader">

          <!--          NOTIFICAÇÕES             -->
          <div class="notificationDiv">
            <div class="position-relative">
              <i class="fa-regular fa-bell" id="notificationBell" onclick="toggleMenu('nSubMenu')"></i>
              <!--          NOTIFICAÇÃO DINÂMICA             -->
              <span class="badge rounded-pill badge-notification bg-danger position-absolute top-0 start-100 translate-middle"></span>
            </div>
            <div class="notificationMenu" id="nSubMenu">
              <ul>
                <li><a href="#">Nenhuma Notificação</a></li>
              </ul>
            </div>
            
          </div>
          
          <!--          ACCOUNT MENU             -->
          <div class="accountMenuDiv">
            <img src="/assets/imgs/userPhoto.png" class="userPic" onclick="toggleMenu('subMenu')">
            <div class="accountMenu" id="subMenu">
              <div class="userInfo">
                <img src="/assets/imgs/userPhoto.png">
                <h2>Marlon Dias</h2>
              </div>
              <hr>
              <ul>
                <li class="notExpandable"><i class="fa-solid fa-arrow-right-from-bracket"></i><a href="/logout" class="link" id="logout"><p>Logout</p><span class="arrowHeaderMenu"> > </span></a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      
    </nav>
  </header>
  <body>
  
    <!--          MENU LATERAL            -->
    <div class="sidebar">
  
      <!-- HOME BUTTON -->
        <a href="/home" class="homeButton">
          <span class="icon"><i class="fa-solid fa-house"></i></span>
          Início
        </a>
  
  
        <ul class="menu">
          <li class="expandable"><i class="fa-solid fa-user-group"></i><p>Clientes</p>
            <ul class="nested">
              <li><a href="/novo-cliente" class="link">Novo Cliente</a></li>
              <li><a href="/listar-clientes" class="link">Lista de Clientes</a></li>
            </ul>
          </li>
          <li class="expandable"><i class="fa-regular fa-clipboard"></i><p>Unidade Consumidora</p>
            <ul class="nested">
              <li><a href="/nova-unidade-consumidora" class="link">Nova U. Consumidora</a></li>
              <li><a href="/listar-unidades-consumidoras" class="link">Lista de U. Consumidoras</a></li>
            </ul>
          </li>
          <li class="expandable"></i><i class="fa-solid fa-arrow-trend-up"></i><p>Análise</p>
            <ul class="nested">
              <li><a href="/nova-analise" class="link">Nova Análise</a></li>
              <li><a href="/listar-analises" class="link">Lista de Análises</a></li>
            </ul>
          </li>
          <li class="expandable"><i class="fa-solid fa-receipt"></i></i><p>Refaturamento</p>
            <ul class="nested">
              <li><a href="/novo-refaturamento" class="link">Novo Refaturamento</a></li>
              <li><a href="/listar-refaturamentos" class="link">Lista de Refaturamentos</a></li>
            </ul>
          </li> 
          <li class="expandable"><i class="fa-solid fa-wrench"></i></i></i><p>Ajustes</p>
            <ul class="nested">
              <li><a href="/novo-ajuste" class="link">Novo Ajuste</a></li>
              <li><a href="/listar-ajustes" class="link">Lista de Ajustes</a></li>
            </ul>
          </li> 
          <li class="expandable"><i class="fa-solid fa-sack-xmark"></i><p>Cobrança Indevida</p>
            <ul class="nested">
              <li><a href="/nova-cobranca" class="link">Nova Cobrança</a></li>
              <li><a href="/listar-cobrancas" class="link">Listar Cobranças</a></li>
            </ul>
          </li>
        </ul>
        <hr>
  
        <ul>
          <li class="notExpandable"><i class="fa-solid fa-arrow-right-from-bracket"></i><a href="/logout" class="link" id="logout"><p>Logout</p></a></li> </li>
        </ul>   
          
    </div>
  
  
  <!-- CONTEUDO DA PAGINA ----------------------->
  
  <form id="form">
    <div class="formulario"  class="form" id="form"> 
      <div class="addButtonDiv"><a href="/nova-analise" class="buttonLink"><button type="button" class="addNovoButton">Add Novo</button></a></div>

      <div class="formArea">
      <div class="formContainer">
        <div class="form-row">
          <div>
            <select name="client_id" placeholder="Selecionar CLiente" id="client_id_select" required="required" class="clientselect">
              <option value="">Selecione um cliente</option>
              <% client.forEach(client => { %>
                <option value="<%= client.id %>">
                  <%= client.nome %>
                </option>
                <% }) %>
            </select>
          </div>
          <div>
            <select name="unidadeConsumidora_id" placeholder="Selecionar Unidade Consumidora" id="unidadeConsumidora"  required="required" class="clientselect">
              <option value="">Selecione uma Unidade Consumidora</option>
              <% unidadeConsumidora.forEach(unidadeConsumidora => { %>
                <option value="<%= unidadeConsumidora.id %>">
                  <%= unidadeConsumidora.unidadeConsumidora %>
                </option>
                <% }) %>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-row-3">
            <input placeholder="Mês/Ano" type="text" onfocus="(this.type='month')" id="mesAno" name="mesAno">
          </div>
          
          <div class="form-row-3">
            <input type="text" id="valorInicial" placeholder="Valor Inicial" name="valorInicial" >
          </div>
          <div class="form-row-3">
            <input type="text" id="valoFinal" placeholder="Valor Final" name="valorFinal">
          </div>
        </div>

        
        <div class="form-row">
          <div class="form-row-3">
            <input type="text" id="consumoPonta" placeholder="Consumo (Ponta)" name="consumoPonta">
          </div>
          
          <div class="form-row-3">
            <input type="text" id="consumoForaPonta" placeholder="Consumo (Fora Ponta)" name="consumoForaPonta">
          </div>
          <div class="form-row-3">
            <input type="text" id="consumoHR" placeholder="Consumo (HR)" name="consumoHR">
          </div>
        </div>
        <div class="form-row">
          <div class="form-row-3">
            <input type="text" id="demandaLida" placeholder="Demanda Lida" name="demandaLida">
          </div>
          
          <div class="form-row-3">
            <input type="text" id="demandaContratada" placeholder="Demanda contratada" name="demandaContratada">
          </div>
          <div class="form-row-3">
            <input type="text" id="demandaFaturada" placeholder="Demanda Faturada" name="demandaFaturada">
          </div>
        </div>
        <div class="form-row">
          <div class="form-row-3">
            <select name="adicionalBandeiraPonta" id="adicionalBandeiraPonta" required>
              <option value="">Adicional Bandeira Ponta</option>
              <option value="Amarela">Amarela</option> 
              <option value="Vermelha">Vermelha</option>
            </select>
          </div>
          
          <div class="form-row-3">
            <select name="adicionalBandeiraForaPonta" id="adicionalBandeiraForaPonta" required>
              <option value="">Adicional Bandeira Fora Ponta</option>
              <option value="Amarela">Amarela</option> 
              <option value="Vermelha">Vermelha</option>
            </select>
          </div>
          <div class="form-row-3">
            <select name="adicionalBandeiraHR" id="adicionalBandeiraHR" required>
              <option value="">Adicional Band HR</option>
              <option value="Amarela">Amarela</option> 
              <option value="Vermelha">Vermelha</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-row-3">
            <input type="text" id="ufer" placeholder="Ufer Ponta" name="ufer">
          </div>
          
          <div class="form-row-3">
            <input type="text" id="uferForaPonta" placeholder="Ufer fora ponta" name="uferForaPonta">
          </div>
          <div class="form-row-3">
            <input type="text" id="uferHR" placeholder="Ufer HR" name="uferHR">
          </div>
        </div>
        <div class="form-row">
          <div class="form-row-3">
            <input type="text" id="compensacaoDicMensal" placeholder="Compensação Dic Mensal" name="compensacaoDicMensal">
          </div>
          
          <div class="form-row-3">
            <input type="text" id="compensacaoDicTrimestral" placeholder="Compensação Dic Trimestral" name="compensacaoDicTrimestral">
          </div>
          <div class="form-row-3">
            <input type="text" id="compensacaoDicAnual" placeholder="Compensação Dic Anual" name="compensacaoDicAnual">
          </div>
        </div>
        <div class="form-row">
          <div class="form-row-3">
            <input type="text" id="compensacaoDecMensal" placeholder="Compensação Dec Mensal" name="compensacaoDecMensal">
          </div>
          
          <div class="form-row-3">
            <input type="text" id="compensaçãoDecTrimestal" placeholder="Compensação Dec Trimestral" name="compensacaoDecTrimestral">
          </div>
          <div class="form-row-3">
            <input type="text" id="compensaçãoDecAnual" placeholder="Compensação Dec Anual" name="compensacaoDecAnual">
          </div>
        </div>
        <div class="form-row">
          <div class="form-row-3">
            <input type="text" id="compensacaoFicMensal" placeholder="Compensação Fic Mensal" name="compensacaoFicMensal">
          </div>
          
          <div class="form-row-3">
          <input type="text" id="compensacaoFicTrimestral" placeholder="Compensação Fic Trimestral" name="compensacaoFicTrimestral">
          </div>
          <div class="form-row-3">
            <input type="text" id="compensacaoFicAnual" placeholder="Compensação Fic Anual" name="compensacaoFicAnual">
          </div>
        </div>
        <div class="form-row">
          <div class="form-row-3">
            <input type="text" id="compensacaoFecMensal" placeholder="Compensação Fec Mensal" name="compensacaoFecMensal"/>
          </div>
          
          <div class="form-row-3">
            <input type="text" id="compensacaoFecTrimestral" placeholder="Compensação Fec Trimestral" name="compensacaoFecTrimestral">
          </div>
          <div class="form-row-3">
            <input type="text" id="compensacaoFecAnual" placeholder="Compensação Fec Anual" name="compensacaoFecAnual">
          </div>
        </div>
        <div class="form-row">
          <div class="form-row-3">
            <input type="text" id="compensacaoDMICMensal" placeholder="Compensação DMIC Mensal" name="compensacaoDMICMensal">
          </div>
          
          <div class="form-row-3">
            <input type="text" id="compensacaoDMICTrimestral" placeholder="Compensação DMIC Trimestral" name="compensacaoDMICTrimestral">
          </div>
          <div class="form-row-3">
            <input type="text" id="compensacaoDMICAnual" placeholder="Compensação DMIC Anual" name="compensacaoDMICAnual">
          </div>
        </div>
        <div class="form-row">
          <div class="form-row-3">
            <input type="text" id="multa" placeholder="Multa" name="multa">
          </div>
          
          <div class="form-row-3">
            <input type="text" id="juros" placeholder="Juros" name="juros">
          </div>
          <div class="form-row-3">
            <input type="text" id="outros" placeholder="Outros" name="outros">
          </div>
        </div>
        <div class="form-row">
          <select name="faturaOk" id="faturaok" placeholder="Fatura está ok?" required>
            <option value="">Fatura está okay?</option>
            <option value="Sim">Sim</option> <!--- Trocar Essas opções pela função pra pegar do backend os clientes-->
            <option value="Não">Não</option>
          </select>
        </div>
    </div>

      <div class="buttonContainer">
        <button type="submit" class="salvarButton">Salvar</button>
      </div>

  </form>
  <script src="/assets/js/novaAnalise.js"></script>
  <script>
   document.addEventListener("DOMContentLoaded", function(event) {
      const clienteIdSelector = document.getElementById('client_id_select')
      const unidadeConsumidoraSelector = document.getElementById('unidadeConsumidora')
      clienteIdSelector.addEventListener('change', clientGetConsumerUnity) 

      
      function setConsumerUnities(data) {
       
        function addOption(obj) {
            const option = document.createElement('option')
            option.setAttribute('value', obj.unidadeConsumidora)
            option.innerHTML = obj.unidadeConsumidora
            unidadeConsumidoraSelector.appendChild(option)
        }
        addOption(data)
      }

      function clientGetConsumerUnity() {
        const client_id = clienteIdSelector.value
      
        if (client_id == '') return
          
        fetch(`${window.location.origin}/select-unidade-consumidora-by-id/${client_id}`)
          .then(data => data.json())
          .then(data => {
            unidadeConsumidora.innerHTML = ""
            data.forEach(data => setConsumerUnities(data))
          })
          .catch(error => console.log(error))
      }
    })

    const dateInput = document.getElementById("dataDeNascimento");
    
    dateInput.addEventListener('focus', () => {
        const today = new Date().toISOString().substr(0, 10);
        const dateValue = dateInput.value;
        const [year, month, day] = dateValue.split("-");
        const formattedDate = `${day}/${month}/${year}`;
        
        if (!dateValue) {
            dateInput.value = "";
        } else {
            dateInput.value = formattedDate;
        }
    });


  </script>  
</body>
</html>